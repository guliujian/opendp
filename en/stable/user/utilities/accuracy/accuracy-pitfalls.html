
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Accuracy: Pitfalls and Edge Cases &#8212; OpenDP</title>
  <script>
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=1e1de1a1873e13ef5536" rel="stylesheet">

  
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/utilities/accuracy/accuracy-pitfalls';</script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Parameter Search" href="../parameter-search.html" />
    <link rel="prev" title="Accuracy" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../../../index.html">

  
  
  
  
  
  
  

  
    <img src="../../../_static/opendp-logo.png" class="logo__image only-light" alt="Logo image">
    <img src="../../../_static/opendp-logo.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../../../quickstart.html">
                        Quickstart
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../../index.html">
                        User Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../examples/index.html">
                        Examples
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../api/index.html">
                        API
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../developer/index.html">
                        Developer Guide
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../../../resources/index.html">
                        Resources
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../opendp-commons/index.html">
                        OpenDP Commons
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../contact.html">
                        Contact
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      <div class="navbar-end-item navbar-end__search-button-container">
        
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
      </div>
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://twitter.com/opendp_org" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/opendp/opendp/discussions" title="GitHub Discussions" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="far fa-comments"></i></span>
            <label class="sr-only">GitHub Discussions</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>


  
  <div class="search-button-container--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
  </div>

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                <li class="nav-item">
                    <a class="nav-link" href="../../../quickstart.html">
                        Quickstart
                    </a>
                </li>
                

                <li class="nav-item current active">
                    <a class="nav-link" href="../../index.html">
                        User Guide
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../examples/index.html">
                        Examples
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../api/index.html">
                        API
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../developer/index.html">
                        Developer Guide
                    </a>
                </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                <li class="nav-item">
                    <a class="nav-link" href="../../../resources/index.html">
                        Resources
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../opendp-commons/index.html">
                        OpenDP Commons
                    </a>
                </li>
                

                <li class="nav-item">
                    <a class="nav-link" href="../../../contact.html">
                        Contact
                    </a>
                </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <span class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" data-toggle="tooltip">
    <a class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></a>
    <a class="theme-switch" data-mode="dark"><i class="fa-regular fa-moon"></i></a>
    <a class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></a>
</span>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/opendp" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://twitter.com/opendp_org" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          <a href="https://github.com/opendp/opendp/discussions" title="GitHub Discussions" class="nav-link" rel="noopener" target="_blank" data-toggle="tooltip"><span><i class="far fa-comments"></i></span>
            <label class="sr-only">GitHub Discussions</label></a>
        </li>
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Section navigation">
  <p class="bd-links__title" role="heading" aria-level="1">
    Section Navigation
  </p>
  <div class="bd-toc-item navbar-nav">
    <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../programming-framework/index.html">Programming Framework</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../programming-framework/core-structures.html">Core Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../programming-framework/supporting-elements.html">Supporting Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../programming-framework/a-framework-to-understand-dp.html">A Framework to Understand DP</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../constructors/index.html">Constructors</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../constructors/transformations.html">Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../constructors/measurements.html">Measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../constructors/combinators.html">Combinators</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Utilities</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../typing.html">Typing</a></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">Accuracy</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Accuracy: Pitfalls and Edge Cases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../parameter-search.html">Parameter Search</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../putting-it-together.html">Putting It Together</a></li>
</ul>

  </div>
</nav>
    </div>
    <div class="sidebar-start-items__item">
<h6>Branches</h6>
<ul>
    <li><a href="../../../../latest/index.html" style="font-weight: normal">latest</a></li>
    <li><a href="accuracy-pitfalls.html" style="font-weight: bold">stable</a></li>
</ul>


<h6 id="releases_header">Releases
    <div id="releases_symbol" style="float:right"></div>
</h6>
<ul id="releases_content">
    <li><a href="../../../../v0.6.1/index.html" style="font-weight: normal">v0.6.1</a></li>
    <li><a href="../../../../v0.6.1-rc.1/index.html" style="font-weight: normal">v0.6.1-rc.1</a></li>
    <li><a href="../../../../v0.6.0/index.html" style="font-weight: normal">v0.6.0</a></li>
    <li><a href="../../../../v0.6.0-rc.7/index.html" style="font-weight: normal">v0.6.0-rc.7</a></li>
    <li><a href="../../../../v0.6.0-rc.6/index.html" style="font-weight: normal">v0.6.0-rc.6</a></li>
    <li><a href="../../../../v0.6.0-rc.5/index.html" style="font-weight: normal">v0.6.0-rc.5</a></li>
    <li><a href="../../../../v0.6.0-rc.4/index.html" style="font-weight: normal">v0.6.0-rc.4</a></li>
    <li><a href="../../../../v0.6.0-rc.3/index.html" style="font-weight: normal">v0.6.0-rc.3</a></li>
    <li><a href="../../../../v0.6.0-rc.2/index.html" style="font-weight: normal">v0.6.0-rc.2</a></li>
    <li><a href="../../../../v0.6.0-rc.1/index.html" style="font-weight: normal">v0.6.0-rc.1</a></li>
    <li><a href="../../../../v0.5.0/index.html" style="font-weight: normal">v0.5.0</a></li>
    <li><a href="../../../../v0.5.0-rc.1/index.html" style="font-weight: normal">v0.5.0-rc.1</a></li>
    <li><a href="../../../../v0.4.0/index.html" style="font-weight: normal">v0.4.0</a></li>
    <li><a href="../../../../v0.3.0/index.html" style="font-weight: normal">v0.3.0</a></li>
    <li><a href="../../../../v0.2.4/index.html" style="font-weight: normal">v0.2.4</a></li>
    <li><a href="../../../../v0.2.3/index.html" style="font-weight: normal">v0.2.3</a></li>
    <li><a href="../../../../v0.2.2/index.html" style="font-weight: normal">v0.2.2</a></li>
    <li><a href="../../../../v0.2.1/index.html" style="font-weight: normal">v0.2.1</a></li>
    <li><a href="../../../../v0.2.0/index.html" style="font-weight: normal">v0.2.0</a></li>
    <li><a href="../../../../v0.1.0/index.html" style="font-weight: normal">v0.1.0</a></li>
</ul>
<script>
    let expanded = !!JSON.parse(localStorage.getItem('expanded'));

    let releasesHeader = document.getElementById("releases_header");
    let releasesSymbol = document.getElementById("releases_symbol");
    let releasesContent = document.getElementById("releases_content");

    function setReleasesState() {
        localStorage.setItem("expanded", JSON.stringify(expanded))
        releasesContent.style.display = expanded ? "block" : "none";
        releasesSymbol.classList.add(expanded ? 'minus' : 'plus')
        releasesSymbol.classList.remove(expanded ? 'plus' : 'minus')
    }

    setReleasesState()
    releasesHeader.addEventListener("click", function() {
        expanded = !expanded;
        setReleasesState()
    })
</script>
<style>
    .plus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .plus:before,
    .plus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .plus:before {
        left:50%;
        top:4px;
        bottom:4px;
        width:3px;
        transform:translateX(-50%);
    }

    .plus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }



    .minus {
        position: relative;
        width:20px;
        height:20px;
        background:#676767;
    }

    .minus:before,
    .minus:after {
        content: "";
        position:absolute;
        background:#fff;
    }

    .minus:after {
        top:50%;
        left:4px;
        right:4px;
        height:3px;
        transform:translateY(-50%);
    }
</style>

    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

      </div>
      <main class="bd-main">
        
        
        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                
            </div>
            
            
            <article class="bd-article" role="main">
              
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="admonition note">
  This page was generated from
  <a class="reference external" href="https://github.com/opendp/opendp/tree/main/docs/source/user/utilities/accuracy/accuracy-pitfalls.ipynb" target="_blank">docs/source/user/utilities/accuracy/accuracy-pitfalls.ipynb</a>.
  Interactive online version:
  <span style="white-space: nowrap;"><a href="https://mybinder.org/v2/gh/opendp/opendp/main?filepath=docs/source/user/utilities/accuracy/accuracy-pitfalls.ipynb" target="_blank"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a>.</span>
</div><section id="Accuracy:-Pitfalls-and-Edge-Cases">
<h1>Accuracy: Pitfalls and Edge Cases<a class="headerlink" href="#Accuracy:-Pitfalls-and-Edge-Cases" title="Permalink to this heading">#</a></h1>
<p>This notebook describes OpenDP’s accuracy calculations, and ways in which an analyst might be tripped up by them.</p>
<section id="Overview">
<h2>Overview<a class="headerlink" href="#Overview" title="Permalink to this heading">#</a></h2>
<section id="Accuracy-vs. Confidence-Intervals">
<h3>Accuracy vs. Confidence Intervals<a class="headerlink" href="#Accuracy-vs. Confidence-Intervals" title="Permalink to this heading">#</a></h3>
<p>Each privatizing mechanism (e.g. Laplace, Gaussian) in OpenDP has an associated accuracy that is a function of alpha and either sigma or accuracy. Imagine you have data <span class="math notranslate nohighlight">\(D\)</span>, and you want, for some function <span class="math notranslate nohighlight">\(\phi\)</span> to return <span class="math notranslate nohighlight">\(\phi(D)\)</span> in a differentially private way – we will call this value <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span>. An <span class="math notranslate nohighlight">\(\alpha\)</span>-level accuracy guarantee <span class="math notranslate nohighlight">\(a\)</span> promises that, over infinite runs of the privatizing mechanism on the data in question,</p>
<div class="math notranslate nohighlight">
\[\phi(D) \in [\phi_{dp}(D) - a, \phi_{dp}(D) + a]\]</div>
<p>with probability <span class="math notranslate nohighlight">\(1 - \alpha\)</span>.</p>
<p>This looks very much like the traditional confidence interval, but it is important to note a major difference. In a canonical confidence interval, the uncertainty being represented is due to sampling error – that is, how often will it be the case that <span class="math notranslate nohighlight">\(\phi(P)\)</span> (the value of <span class="math notranslate nohighlight">\(\phi\)</span> on the underlying population) is within some range of the realized <span class="math notranslate nohighlight">\(\phi(D)\)</span>.</p>
<p>In OpenDP (and differentially private data analysis generally), there is an extra layer of uncertainty due to the noise added to <span class="math notranslate nohighlight">\(\phi(D)\)</span> to produce <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span>. OpenDP’s accuracy metrics deal only with the uncertainty of <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span> relative to <span class="math notranslate nohighlight">\(\phi(D)\)</span> and not the uncertainty of <span class="math notranslate nohighlight">\(\phi(D)\)</span> relative to <span class="math notranslate nohighlight">\(\phi(P)\)</span>.</p>
</section>
<section id="What-is-D?">
<h3>What is <span class="math notranslate nohighlight">\(D\)</span>?<a class="headerlink" href="#What-is-D?" title="Permalink to this heading">#</a></h3>
<p>OpenDP allows for analysis of data with an unknown number of rows by resizing the data to ensure consistency with an estimated size (see the <a class="reference external" href="https://github.com/opendp/opendp/blob/main/python/example/unknown_dataset_size.ipynb">unknown dataset size notebook</a> for more details). Accuracy guarantees are always relative to the preprocessed data <span class="math notranslate nohighlight">\(\tilde{D}\)</span> and operations such as imputation and clipping are not factored into the accuracy.</p>
</section>
<section id="Synopsis">
<h3>Synopsis<a class="headerlink" href="#Synopsis" title="Permalink to this heading">#</a></h3>
<p>Say an analyst releases <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span> and gets an accuracy guarantee of <span class="math notranslate nohighlight">\(a\)</span> at accuracy-level <span class="math notranslate nohighlight">\(\alpha\)</span>. <span class="math notranslate nohighlight">\(D\)</span> is a dataset of unknown size drawn from population <span class="math notranslate nohighlight">\(P\)</span> and will be resized to <span class="math notranslate nohighlight">\(\tilde{D}\)</span>. This suggests that over infinite runs of this procedure,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\phi_{dp}(D) \in [\phi(\tilde{D}) - a, \phi(\tilde{D}) + a]\)</span> with probability <span class="math notranslate nohighlight">\(1 - \alpha\)</span></p></li>
<li><p>It is likely that <span class="math notranslate nohighlight">\(\phi_{dp}(D) \in [\phi(D) - a, \phi(D) + a]\)</span> with probability <span class="math notranslate nohighlight">\(\approx 1 - \alpha\)</span>, though we cannot make any guarantee. For many cases (e.g. resizing the data based on <span class="math notranslate nohighlight">\(n\)</span> obtained from a differentially private count and reasonable bounds on the data elements), this is likely to be approximately true. In the next section, we will explore some examples of cases where this statement holds to varying extents.</p></li>
<li><p>We cannot directly make statements about the relationship uncertainty of <span class="math notranslate nohighlight">\(\phi_{dp}(D)\)</span> relative to <span class="math notranslate nohighlight">\(\phi(P)\)</span>.</p></li>
</ul>
</section>
</section>
<section id="Accuracy-Guarantees-In-Practice">
<h2>Accuracy Guarantees In Practice<a class="headerlink" href="#Accuracy-Guarantees-In-Practice" title="Permalink to this heading">#</a></h2>
<p>We now move to some empirical evaluations of how well our accuracy guarantees translate from <span class="math notranslate nohighlight">\(\phi(\tilde{D})\)</span> to <span class="math notranslate nohighlight">\(\phi(D)\)</span>. We first consider the case where we actually know the size of the underlying data and are able to set plausible lower/upper bounds on <code class="docutils literal notranslate"><span class="pre">age</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load libraries</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">opendp.accuracy</span> <span class="kn">import</span> <span class="n">laplacian_scale_to_accuracy</span>
<span class="kn">from</span> <span class="nn">opendp.measurements</span> <span class="kn">import</span> <span class="n">make_base_laplace</span><span class="p">,</span> <span class="n">AllDomain</span><span class="p">,</span> <span class="n">InherentNullDomain</span>
<span class="kn">from</span> <span class="nn">opendp.mod</span> <span class="kn">import</span> <span class="n">enable_features</span><span class="p">,</span> <span class="n">binary_search_param</span>
<span class="kn">from</span> <span class="nn">opendp.transformations</span> <span class="kn">import</span> <span class="n">make_split_dataframe</span><span class="p">,</span> <span class="n">make_clamp</span><span class="p">,</span> <span class="n">make_bounded_resize</span><span class="p">,</span> \
    <span class="n">make_sized_bounded_mean</span><span class="p">,</span> <span class="n">make_select_column</span><span class="p">,</span> <span class="n">make_impute_constant</span><span class="p">,</span> <span class="n">make_cast</span>

<span class="n">enable_features</span><span class="p">(</span><span class="s2">&quot;contrib&quot;</span><span class="p">)</span>
<span class="n">enable_features</span><span class="p">(</span><span class="s2">&quot;floating-point&quot;</span><span class="p">)</span>

<span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;PUMS_california_demographics_1000&#39;</span><span class="p">,</span> <span class="s1">&#39;data.csv&#39;</span><span class="p">)</span>
<span class="n">var_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;sex&quot;</span><span class="p">,</span> <span class="s2">&quot;educ&quot;</span><span class="p">,</span> <span class="s2">&quot;race&quot;</span><span class="p">,</span> <span class="s2">&quot;income&quot;</span><span class="p">,</span> <span class="s2">&quot;married&quot;</span><span class="p">,</span> <span class="s2">&quot;pid&quot;</span><span class="p">]</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">age</span>
<span class="n">D_mean_age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>

<span class="c1"># This will provide the data that will be passed to the aggregator</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="c1"># establish extra information for this simulation</span>
<span class="n">age_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)</span>
<span class="n">n_sims</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="n">D_tilde_mean_age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">age_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">age_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">impute_constant</span> <span class="o">=</span> <span class="mf">50.</span>

<span class="k">def</span> <span class="nf">make_mean_aggregator</span><span class="p">(</span><span class="n">data_size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="c1"># Convert data into a dataframe of string columns</span>
        <span class="n">make_split_dataframe</span><span class="p">(</span><span class="n">separator</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">col_names</span><span class="o">=</span><span class="n">var_names</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Selects a column of df, Vec&lt;str&gt;</span>
        <span class="n">make_select_column</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="n">TOA</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Cast the column as Vec&lt;float&gt;</span>
        <span class="n">make_cast</span><span class="p">(</span><span class="n">TIA</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">TOA</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Impute null values</span>
        <span class="n">make_impute_constant</span><span class="p">(</span><span class="n">impute_constant</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Clamp age values</span>
        <span class="n">make_clamp</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="n">age_bounds</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="c1"># Resize the dataset to length `data_size`.</span>
        <span class="c1">#     If there are fewer than `data_size` rows in the data, fill with a constant.</span>
        <span class="c1">#     If there are more than `data_size` rows in the data, only keep `data_size` rows</span>
        <span class="n">make_bounded_resize</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">data_size</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">age_bounds</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="n">impute_constant</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
        <span class="n">make_sized_bounded_mean</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">data_size</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">age_bounds</span><span class="p">)</span>
    <span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_size</span> <span class="o">=</span> <span class="mi">1_000</span>

<span class="n">mean_aggregator</span> <span class="o">=</span> <span class="n">make_mean_aggregator</span><span class="p">(</span><span class="n">data_size</span><span class="p">)</span>

<span class="n">scale</span> <span class="o">=</span> <span class="n">binary_search_param</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">make_base_laplace</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>

<span class="n">measurement</span> <span class="o">=</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">make_base_laplace</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

<span class="n">releases</span> <span class="o">=</span> <span class="p">[</span><span class="n">measurement</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sims</span><span class="p">)]</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">laplacian_scale_to_accuracy</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D_tilde with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_tilde_mean_age</span> <span class="o">&gt;=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_tilde_mean_age</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_mean_age</span> <span class="o">&gt;=</span> <span class="n">val</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_mean_age</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy interval (with accuracy value 0.2996) contains the true mean on D_tilde with probability 0.93
Accuracy interval (with accuracy value 0.2996) contains the true mean on D with probability 0.93
</pre></div></div>
</div>
<p>This performance is as expected. <span class="math notranslate nohighlight">\(D\)</span> and <span class="math notranslate nohighlight">\(\tilde{D}\)</span> are actually the exact same data (the maximum age in the raw data is 93, so our clamp to <span class="math notranslate nohighlight">\([0, 100]\)</span> does not change any values, and we know the correct <span class="math notranslate nohighlight">\(n\)</span>), so our theoretical guarantees on <span class="math notranslate nohighlight">\(\tilde{D}\)</span> map exactly to guarantees on <span class="math notranslate nohighlight">\(D\)</span>.</p>
<p>We now move to a scenario that is still realistic, but where the performance does not translate quite as well. In this case, we imagine that the analyst believes the data to be of size 1050 and uses the default imputation within resize so that the extra 50 elements are replaced with a constant.</p>
<p>Note that our diagnostic testing of <span class="math notranslate nohighlight">\(\tilde{D}\)</span> in the code above is not trivial in this case. In the first example, we knew that clamp/resize did not change the underlying data, so we could predict exactly the data on which the DP mean would actually be calculated. This will not be true for the following examples, so we will simulate finding the true underlying mean by releasing an extra DP mean with very high epsilon.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This estimate is larger than the true size of 1000, so we will impute 50 values using the impute constant</span>
<span class="n">data_size</span> <span class="o">=</span> <span class="mi">1_050</span>

<span class="n">mean_aggregator</span> <span class="o">=</span> <span class="n">make_mean_aggregator</span><span class="p">(</span><span class="n">data_size</span><span class="p">)</span>

<span class="c1"># This value contains the true mean of the data after resizing and imputation</span>
<span class="n">D_tilde_mean</span> <span class="o">=</span> <span class="n">mean_aggregator</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">scale</span> <span class="o">=</span> <span class="n">binary_search_param</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">make_base_laplace</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>

<span class="n">measurement</span> <span class="o">=</span> <span class="n">mean_aggregator</span> <span class="o">&gt;&gt;</span> <span class="n">make_base_laplace</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

<span class="n">releases</span> <span class="o">=</span> <span class="p">[</span><span class="n">measurement</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_sims</span><span class="p">)]</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">laplacian_scale_to_accuracy</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D_tilde with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_tilde_mean</span> <span class="o">&gt;=</span> <span class="n">dp_mean</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_tilde_mean</span> <span class="o">&lt;=</span> <span class="n">dp_mean</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">dp_mean</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy interval (with accuracy value </span><span class="si">{0}</span><span class="s1">) contains the true mean on D with probability </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">D_mean_age</span> <span class="o">&gt;=</span> <span class="n">dp_mean</span> <span class="o">-</span> <span class="n">accuracy</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">D_mean_age</span> <span class="o">&lt;=</span> <span class="n">dp_mean</span> <span class="o">+</span> <span class="n">accuracy</span><span class="p">)</span> <span class="k">for</span> <span class="n">dp_mean</span> <span class="ow">in</span> <span class="n">releases</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy interval (with accuracy value 0.2853) contains the true mean on D_tilde with probability 0.97
Accuracy interval (with accuracy value 0.2853) contains the true mean on D with probability 0.65
</pre></div></div>
</div>
<p>The accuracy guarantee still holds on <span class="math notranslate nohighlight">\(\tilde{D}\)</span> (as it should), but we now see much worse performance relative to the true underlying data <span class="math notranslate nohighlight">\(D\)</span>.</p>
</section>
</section>


            </article>
            
            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="index.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Accuracy</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="../parameter-search.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">Parameter Search</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Overview">
   Overview
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Accuracy-vs. Confidence-Intervals">
     Accuracy vs. Confidence Intervals
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#What-is-D?">
     What is
     <span class="math notranslate nohighlight">
      \(D\)
     </span>
     ?
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Synopsis">
     Synopsis
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Accuracy-Guarantees-In-Practice">
   Accuracy Guarantees In Practice
  </a>
 </li>
</ul>

</nav>
</div>

<div class="toc-item">
  
<div id="searchbox"></div>
</div>

<div class="toc-item">
  
</div>

<div class="toc-item">
  
<div class="tocsection sourcelink">
    <a href="../../../_sources/user/utilities/accuracy/accuracy-pitfalls.ipynb.txt">
        <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
</div>

</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
          </div>
        </footer>
        
      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=1e1de1a1873e13ef5536"></script>

  <footer class="bd-footer"><div class="bd-footer__inner container">
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022.<br>

</p>

  </div>
  
  <div class="footer-item">
    
<p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.1.1.<br>
</p>

  </div>
  
</div>
  </footer>
  </body>
</html>